{% extends "base.html" %}
{% block body %}
<div class="page-content">
   {% if data.requests is not empty %}
   <article class="default-section">
      <div class="aside-title-content">{% if data.requests.status == "closed" %}[GESLOTEN]{% endif %} {{data.requests.subject}}</div>
          <div class="forum-post">
             <div class="forum-author">
                <div class="fpost-user">
                   <strong>
                      <div class="user-style"><a href="{{path}}/profile/{{data.requests.username}}">{{data.requests.author.username}}</a></div>
                   </strong>
                </div>
                <div class="hidden-sm hidden-xs">
                   <div class="forum-post-avatar">
                      <div style="background: url({{fpath}}/avatarimage?figure={{data.requests.author.look}}&amp;head_direction=3&amp;headonly=1) no-repeat center; width: 48px; height: 62px;"></div>
                   </div>
                </div>
                <div class="hidden-sm hidden-xs" style="text-align: left;"><strong>Op:</strong> {{data.requests.timestamp|time_diff}}</div>
                <div class="hidden-sm hidden-xs" style="text-align: left;"><strong>Aantal tickets:</strong> {{data.requests.ctickets}}</div>
             </div>
             <div class="forum-content">
                <div class="forum-body">
                   <div class="content-body">
                      {{data.requests.message|bbcode}}
                   </div>
                </div>
             </div>
     </div>
   </article>
   {% for reaction in data.requests.reactions %}
   <article class="default-section">
      <div class="aside-title-content">Reactie op: {{data.requests.subject}}</div>
      <div class="aside-content">
          <div class="forum-post">
             <div class="forum-author">
                <div class="fpost-user">
                   <strong>
                      <div class="user-style"><a href="{{path}}/profile/{{reaction.username}}">{{reaction.author.username}}</a></div>
                   </strong>
                </div>
                <div class="hidden-sm hidden-xs">
                   <div class="forum-post-avatar">
                      <div style="background: url({{fpath}}/avatarimage?figure={{reaction.author.look}}&amp;head_direction=3&amp;headonly=1) no-repeat center; width: 48px; height: 62px;"></div>
                   </div>
                </div>
                <div class="hidden-sm hidden-xs" style="text-align: left;"><strong>Op:</strong> {{reaction.timestamp|time_diff}}</div>
                {% if reaction.username == player.username %}
                   <div class="hidden-sm hidden-xs" style="text-align: left;"><strong>Aantal tickets:</strong> {{data.requests.ctickets}}</div>
                {% endif %}
             </div>
             <div class="forum-content">
                <div class="forum-body">
                   <div class="content-body">
                      {{reaction.message|raw}}
                   </div>
                </div>
             </div>
          </div>
        </div>
   </article>
   {% endfor %}

   {% if data.requests.status != "closed" %}
      {% if data.requests.latest.practitioner_id != player.id and data.requests.latest != null  %}
      <article class="default-section">
          <div class="aside-title-content">Reageren</div>
          <div class="aside-content">
              <form action="help/requests/createpost" method="post">
                <div class="row space-bottom">
                   <h5>Beschrijving</h5>
                   <textarea name="message" class="rounded-textarea blue-active"></textarea>
                </div>
                <input type="hidden" name="ticketid" value="{{data.requests.id}}" />
                <p style="text-align: center; margin-top: 30px;"><button type="submit" class="rounded-button blue">Reageer op ticket</button></p>
              </form>
          </div>
      </article>
      {% endif %}
   {% endif %}

   {% else %}
   <article class="default-section">
      <div class="aside-title-content">Neem contact op met {{shortname}}</div>
      <div class="aside-content">
          U kunt contact met ons opnemen door een nieuw ticket te openen.
          <p style="text-align: center; margin-top: 30px;"><a href="{{path}}/help/requests/new" class="rounded-button blue">Nieuw ticket</a></p>
      </div>
   </article>
   {% endif %}

   {% if data.tickets is not empty %}
   <article class="default-section">
      <table class="default-table" style="padding: 10px">
         <thead>
            <tr>
               <th></th>
               <th>Onderwerp</th>
               <th>Type</th>
               <th>Ticket geopend</th>
            </tr>
         </thead>
         <tbody>
            {% for request in data.tickets %}
            <tr>
                <td><img src="{{fpath}}/avatarimage?figure={{player.look}}&gesture=sml&headonly=1" alt="{{user.username}}" class="pixelated small-head"></td>
                <td><a href="{{path}}/help/requests/{{request.id}}/view">{{request.subject}}</a></td>
                {% if request.status == "in_treatment" %}
                    <td>In behandeling</td>
                {% elseif request.status == "open" %}
                    <td>Open</td>
                {% else %}
                    <td>Gesloten</td>
                {% endif %}
                <td>{{request.timestamp}}</td>
            </tr>
            {% endfor %}
            
         </tbody>
      </table>
   </article>
   {% endif %}
</div>
<style>
   .forum-post-avatar {
   width: 48px;
   min-height: 70px;
   background-position: center;
   background-repeat: no-repeat;
   margin: auto;
   text-align: center;
   position: relative;
   }
   .forum-body {
   overflow: hidden;
   overflow-wrap: break-word;
   word-wrap: break-word;
   -ms-word-break: break-all;
   word-break: break-all;
   word-break: break-word;
   -ms-hyphens: auto;
   -moz-hyphens: auto;
   -webkit-hyphens: auto;
   hyphens: auto;
   }
   .forum-title {
   border-bottom: 1px solid #eee;
   padding: 0px 5px 10px 5px;
   margin-bottom: 10px;
   }
   .forum-tools {
   border-top: 1px solid #eee;
   margin-left: 150px;
   padding: 10px 15px 10px 15px;
   background: #F5F5F5;
   }
   .fpost-user {
   padding: 5px;
   font-weight: bold;
   }
   .forum-edit-box {
   display: none;
   border-top: 1px solid #eee;
   margin-left: 150px;
   padding: 10px 15px 10px 15px;
   background: #F5F5F5;
   }
   .forum-content {
   margin-left: 150px;
   padding: 10px 20px 20px 20px;
   background: #F5F5F5;
   border-left: 1px solid #eee;
   }
   .forum-author {
   float: left;
   padding: 20px;
   width: 150px;
   height: 100%;
   text-align: center;
   background: white;
   font-size: 12px;
   white-space: nowrap;
   overflow: hidden;
   text-overflow: ellipsis;
   }
   .forum-post {
   background: white;
   width: 100%;
   margin-bottom: 10px;
   overflow: hidden;
   overflow-wrap: break-word;
   word-wrap: break-word;
   -ms-word-break: break-all;
   word-break: break-all;
   word-break: break-word;
   -ms-hyphens: auto;
   -moz-hyphens: auto;
   -webkit-hyphens: auto;
   hyphens: auto;
   box-shadow: 0 2px 0 0 rgba(0, 0, 0, 0.17), inset 0 0 0 0px rgba(0, 0, 0, 0.23);
   }
</style>
{% endblock %}